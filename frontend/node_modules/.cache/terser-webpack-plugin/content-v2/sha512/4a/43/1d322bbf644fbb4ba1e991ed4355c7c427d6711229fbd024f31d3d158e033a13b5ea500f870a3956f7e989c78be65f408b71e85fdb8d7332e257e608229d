{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{mX50:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__);var core=__webpack_require__(\"8Y7J\");class BuyBooksPageModule{}var router_ngfactory=__webpack_require__(\"pMnS\"),ionic_angular_ngfactory=__webpack_require__(\"MKJQ\"),ionic_angular=__webpack_require__(\"sZkV\"),common=__webpack_require__(\"SVse\"),storage_service=__webpack_require__(\"n90K\"),toast_service=__webpack_require__(\"2g2N\");class BuyBooksPage{constructor(firestore,storage,auth,toast,storageService,router){this.firestore=firestore,this.storage=storage,this.auth=auth,this.toast=toast,this.storageService=storageService,this.router=router,this.items=[]}message(item){this.router.navigateByUrl(\"message\",{state:{recipient:item.Owner}})}buy(item){this.user[\"Amount Left\"]>=item.Price?this.auth.currentUser.then(res=>{this.user[\"Amount Left\"]=this.user[\"Amount Left\"]-parseFloat(item.Price),this.firestore.firestore.collection(\"users\").doc(res.uid).update({\"Amount Left\":this.user[\"Amount Left\"]}).then(()=>{this.firestore.firestore.collection(\"Books\").doc(item.id).get().then(res=>{this.firestore.firestore.collection(\"Books\").doc(item.id).delete().then(()=>{}).catch(err=>{console.dir(err)})}).catch(err=>{console.dir(err)}),this.firestore.firestore.collection(\"users\").doc(item.Owner).get().then(res=>{var v=res.data();v[\"Amount Left\"]+=parseFloat(item.Price),this.firestore.firestore.collection(\"users\").doc(item.Owner).update({\"Amount Left\":v[\"Amount Left\"]}).then(()=>{this.toast.presentToast(\"Successful purchase\"),this.ngOnInit()}).catch(err=>{console.dir(err)})}).catch(err=>{console.dir(err)})}).catch(err=>{console.dir(err)})}).catch(err=>{console.dir(err)}):this.toast.presentToast(\"You don't have enough credits for that.\")}ngOnInit(){this.auth.currentUser.then(res=>{this.storageService.get(res.uid).then(res=>{this.user=res,this.items=[],this.firestore.firestore.collection(\"Books\").get().then(res=>{res.docs.forEach(doc=>{var i=doc.data();i.id=doc.id,this.storage.storage.refFromURL(doc.data()[\"Image-REF\"][0]).getDownloadURL().then(url=>{i[\"Image-URL\"]=url}).then(()=>{this.auth.currentUser.then(res=>{i.Owner!=res.uid&&this.items.push(i)})}).catch(err=>{console.dir(err)})})})})})}}var angular_fire_firestore=__webpack_require__(\"wD+u\"),angular_fire_storage=__webpack_require__(\"fMxG\"),angular_fire_auth=__webpack_require__(\"VRCc\"),router=__webpack_require__(\"iInd\"),RenderType_BuyBooksPage=core.ob({encapsulation:0,styles:[[\"ion-toolbar[_ngcontent-%COMP%]{position:absolute}ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;color:#d4af37;font-style:italic;font-family:cursive}ion-text[_ngcontent-%COMP%]{position:relative}ion-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;color:#416;font-style:italic;font-family:cursive;margin-top:30%}.actions[_ngcontent-%COMP%]{position:relative;margin-top:15%}.actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius:9px;--box-shadow:none;--background:linear-gradient(60deg, #D4AF37 0%, #416 100%);text-transform:initial;font-size:12px}.actions[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:14px}\"]],data:{}});function View_BuyBooksPage_1(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,2,\"div\",[],null,null,null,null,null)),(_l()(),core.qb(1,0,null,null,1,\"h2\",[],null,null,null,null,null)),(_l()(),core.Gb(2,null,[\"Balance: C \",\"\"]))],null,(function(_ck,_v){_ck(_v,2,0,_v.component.user[\"Amount Left\"])}))}function View_BuyBooksPage_2(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,16,\"ion-card\",[],null,null,null,ionic_angular_ngfactory.L,ionic_angular_ngfactory.d)),core.pb(1,49152,null,0,ionic_angular.j,[core.h,core.k,core.x],null,null),(_l()(),core.qb(2,0,null,0,0,\"img\",[[\"alt\",\"\"]],[[8,\"src\",4]],[[null,\"srcChange\"]],(function(_v,en,$event){var ad=!0;return\"srcChange\"===en&&(ad=!1!==(_v.context.$implicit[\"Image-URL\"]=$event)&&ad),ad}),null,null)),(_l()(),core.qb(3,0,null,0,13,\"ion-list\",[],null,null,null,ionic_angular_ngfactory.V,ionic_angular_ngfactory.q)),core.pb(4,49152,null,0,ionic_angular.L,[core.h,core.k,core.x],null,null),(_l()(),core.qb(5,0,null,0,1,\"h1\",[],null,null,null,null,null)),(_l()(),core.Gb(6,null,[\"\",\"\"])),(_l()(),core.qb(7,0,null,0,3,\"ion-label\",[],null,null,null,ionic_angular_ngfactory.U,ionic_angular_ngfactory.p)),core.pb(8,49152,null,0,ionic_angular.K,[core.h,core.k,core.x],null,null),(_l()(),core.Gb(9,0,[\"C \",\" \"])),(_l()(),core.qb(10,0,null,0,0,\"br\",[],null,null,null,null,null)),(_l()(),core.qb(11,0,null,0,2,\"ion-button\",[[\"expand\",\"block\"]],null,[[null,\"click\"]],(function(_v,en,$event){var ad=!0;return\"click\"===en&&(ad=!1!==_v.component.buy(_v.context.$implicit)&&ad),ad}),ionic_angular_ngfactory.G,ionic_angular_ngfactory.b)),core.pb(12,49152,null,0,ionic_angular.h,[core.h,core.k,core.x],{expand:[0,\"expand\"]},null),(_l()(),core.Gb(-1,0,[\"Buy\"])),(_l()(),core.qb(14,0,null,0,2,\"ion-button\",[[\"expand\",\"block\"]],null,[[null,\"click\"]],(function(_v,en,$event){var ad=!0;return\"click\"===en&&(ad=!1!==_v.component.message(_v.context.$implicit)&&ad),ad}),ionic_angular_ngfactory.G,ionic_angular_ngfactory.b)),core.pb(15,49152,null,0,ionic_angular.h,[core.h,core.k,core.x],{expand:[0,\"expand\"]},null),(_l()(),core.Gb(-1,0,[\"Contact Seller\"]))],(function(_ck,_v){_ck(_v,12,0,\"block\"),_ck(_v,15,0,\"block\")}),(function(_ck,_v){_ck(_v,2,0,_v.context.$implicit[\"Image-URL\"]),_ck(_v,6,0,_v.context.$implicit.Title),_ck(_v,9,0,_v.context.$implicit.Price)}))}function View_BuyBooksPage_0(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,11,\"ion-header\",[],null,null,null,ionic_angular_ngfactory.Q,ionic_angular_ngfactory.l)),core.pb(1,49152,null,0,ionic_angular.y,[core.h,core.k,core.x],null,null),(_l()(),core.qb(2,0,null,0,9,\"ion-toolbar\",[],null,null,null,ionic_angular_ngfactory.jb,ionic_angular_ngfactory.E)),core.pb(3,49152,null,0,ionic_angular.wb,[core.h,core.k,core.x],null,null),(_l()(),core.qb(4,0,null,0,3,\"ion-title\",[],null,null,null,ionic_angular_ngfactory.ib,ionic_angular_ngfactory.D)),core.pb(5,49152,null,0,ionic_angular.ub,[core.h,core.k,core.x],null,null),(_l()(),core.qb(6,0,null,0,1,\"h1\",[],null,null,null,null,null)),(_l()(),core.Gb(-1,null,[\"Buy Books\"])),(_l()(),core.qb(8,0,null,0,3,\"ion-buttons\",[[\"slot\",\"start\"]],null,null,null,ionic_angular_ngfactory.H,ionic_angular_ngfactory.c)),core.pb(9,49152,null,0,ionic_angular.i,[core.h,core.k,core.x],null,null),(_l()(),core.qb(10,0,null,0,1,\"ion-menu-button\",[[\"menu\",\"main-menu\"]],null,null,null,ionic_angular_ngfactory.W,ionic_angular_ngfactory.s)),core.pb(11,49152,null,0,ionic_angular.O,[core.h,core.k,core.x],{menu:[0,\"menu\"]},null),(_l()(),core.qb(12,0,null,null,10,\"ion-content\",[[\"class\",\"ion-padding\"]],null,null,null,ionic_angular_ngfactory.N,ionic_angular_ngfactory.i)),core.pb(13,49152,null,0,ionic_angular.r,[core.h,core.k,core.x],{fullscreen:[0,\"fullscreen\"]},null),(_l()(),core.qb(14,0,null,0,8,\"ion-list\",[],null,null,null,ionic_angular_ngfactory.V,ionic_angular_ngfactory.q)),core.pb(15,49152,null,0,ionic_angular.L,[core.h,core.k,core.x],null,null),(_l()(),core.qb(16,0,null,0,3,\"ion-text\",[],null,null,null,ionic_angular_ngfactory.gb,ionic_angular_ngfactory.B)),core.pb(17,49152,null,0,ionic_angular.rb,[core.h,core.k,core.x],null,null),(_l()(),core.fb(16777216,null,0,1,null,View_BuyBooksPage_1)),core.pb(19,16384,null,0,common.i,[core.N,core.J],{ngIf:[0,\"ngIf\"]},null),(_l()(),core.qb(20,0,null,0,2,\"div\",[[\"class\",\"actions\"]],null,null,null,null,null)),(_l()(),core.fb(16777216,null,null,1,null,View_BuyBooksPage_2)),core.pb(22,278528,null,0,common.h,[core.N,core.J,core.q],{ngForOf:[0,\"ngForOf\"]},null)],(function(_ck,_v){var _co=_v.component;_ck(_v,11,0,\"main-menu\"),_ck(_v,13,0,!0),_ck(_v,19,0,_co.user),_ck(_v,22,0,_co.items)}),null)}function View_BuyBooksPage_Host_0(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,1,\"app-buy-books\",[],null,null,null,View_BuyBooksPage_0,RenderType_BuyBooksPage)),core.pb(1,114688,null,0,BuyBooksPage,[angular_fire_firestore.a,angular_fire_storage.a,angular_fire_auth.a,toast_service.a,storage_service.a,router.m],null,null)],(function(_ck,_v){_ck(_v,1,0)}),null)}var BuyBooksPageNgFactory=core.mb(\"app-buy-books\",BuyBooksPage,View_BuyBooksPage_Host_0,{},{},[]),fesm2015_forms=__webpack_require__(\"s7LF\");class BuyBooksPageRoutingModule{}__webpack_require__.d(__webpack_exports__,\"BuyBooksPageModuleNgFactory\",(function(){return BuyBooksPageModuleNgFactory}));var BuyBooksPageModuleNgFactory=core.nb(BuyBooksPageModule,[],(function(_l){return core.zb([core.Ab(512,core.j,core.Y,[[8,[router_ngfactory.a,BuyBooksPageNgFactory]],[3,core.j],core.v]),core.Ab(4608,common.k,common.j,[core.s,[2,common.q]]),core.Ab(4608,fesm2015_forms.l,fesm2015_forms.l,[]),core.Ab(4608,ionic_angular.a,ionic_angular.a,[core.x,core.g]),core.Ab(4608,ionic_angular.Ab,ionic_angular.Ab,[ionic_angular.a,core.j,core.p]),core.Ab(4608,ionic_angular.Db,ionic_angular.Db,[ionic_angular.a,core.j,core.p]),core.Ab(1073742336,common.b,common.b,[]),core.Ab(1073742336,fesm2015_forms.k,fesm2015_forms.k,[]),core.Ab(1073742336,fesm2015_forms.b,fesm2015_forms.b,[]),core.Ab(1073742336,ionic_angular.yb,ionic_angular.yb,[]),core.Ab(1073742336,router.o,router.o,[[2,router.t],[2,router.m]]),core.Ab(1073742336,BuyBooksPageRoutingModule,BuyBooksPageRoutingModule,[]),core.Ab(1073742336,BuyBooksPageModule,BuyBooksPageModule,[]),core.Ab(1024,router.k,(function(){return[[{path:\"\",component:BuyBooksPage}]]}),[])])}))}}]);","extractedComments":[]}