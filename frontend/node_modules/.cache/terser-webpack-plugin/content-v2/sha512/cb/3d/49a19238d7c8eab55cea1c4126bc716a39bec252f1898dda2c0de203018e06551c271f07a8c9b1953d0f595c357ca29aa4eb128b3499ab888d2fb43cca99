{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{nylZ:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__);var core=__webpack_require__(\"8Y7J\");class MessagePageModule{}var router_ngfactory=__webpack_require__(\"pMnS\"),ionic_angular_ngfactory=__webpack_require__(\"MKJQ\"),ionic_angular=__webpack_require__(\"sZkV\"),fesm2015_forms=__webpack_require__(\"s7LF\"),common=__webpack_require__(\"SVse\"),storage_service=__webpack_require__(\"n90K\");class MessagePage{constructor(auth,storage,storageService,firestore){this.auth=auth,this.storage=storage,this.storageService=storageService,this.firestore=firestore,this.reply={content:\"\",metadata:{date:\"\",time:0,type:\"\"}}}ngOnInit(){this.recipient=history.state.recipient,this.auth.currentUser.then(res=>{this.firestore.firestore.collection(\"users/\"+res.uid+\"/Chats\").doc(this.recipient).onSnapshot(snap=>{try{this.messages=snap.data().Messages}catch(_a){this.firestore.firestore.collection(\"users/\"+res.uid+\"/Chats\").doc(this.recipient).set({Messages:[]}),this.ngOnInit()}},err=>{console.dir(err)}),this.storageService.get(res.uid).then(res=>{this.user=res}).catch(err=>{console.dir(err)})})}sendMessage(){var today=new Date;this.reply.metadata.date=today.getFullYear()+\"-\"+(today.getMonth()+1)+\"-\"+today.getDate(),this.reply.metadata.time=today.getTime(),this.reply.metadata.type=\"sent\",this.auth.currentUser.then(res=>{var uid=res.uid;this.messages.push(this.reply),this.firestore.firestore.collection(\"users/\"+res.uid+\"/Chats\").doc(this.recipient).update({Messages:this.messages}).then(()=>{this.firestore.firestore.collection(\"users/\"+this.recipient+\"/Chats\").doc(uid).get().then(res=>{try{var m=res.data().Messages;this.reply.metadata.type=\"received\",m.push(this.reply),this.firestore.firestore.collection(\"users/\"+this.recipient+\"/Chats\").doc(uid).update({Messages:m})}catch(_a){this.reply.metadata.type=\"received\",this.firestore.firestore.collection(\"users/\"+this.recipient+\"/Chats\").doc(uid).set({Messages:this.reply})}this.reply.content=\"\"}).catch(err=>{console.dir(err)})})})}}var angular_fire_auth=__webpack_require__(\"VRCc\"),angular_fire_storage=__webpack_require__(\"fMxG\"),angular_fire_firestore=__webpack_require__(\"wD+u\"),RenderType_MessagePage=core.ob({encapsulation:0,styles:[['ion-header[_ngcontent-%COMP%]{position:absolute;height:30px;margin-top:10%;margin-bottom:10%}ion-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;color:#416;font-style:italic;font-family:cursive}.main-body[_ngcontent-%COMP%]{position:absolute;margin-top:30%}.innerMessage[_ngcontent-%COMP%]{position:relative;padding:5px 10px;background:#416;margin:5px;color:#fff;border-radius:3px;display:block}.innerMessage.messageRight[_ngcontent-%COMP%]{background:#d4af37;margin-left:25%;flex-wrap:wrap}.innerMessage.messageLeft[_ngcontent-%COMP%]{margin-right:25%}.message[_ngcontent-%COMP%]{font-size:120%}.elem[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0;margin:0;position:absolute;top:0;left:0;width:100%;height:100%}.elem[_ngcontent-%COMP%]{position:relative;min-width:50px}div#footer[_ngcontent-%COMP%]   div.elem[_ngcontent-%COMP%]:first-child{flex-grow:1}div#footer[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:stretch}ion-input[_ngcontent-%COMP%]{padding-left:15px;font-size:125%}ion-toolbar[_ngcontent-%COMP%]{margin:0;padding:0!important}.innerMessage[_ngcontent-%COMP%]:after{content:\"\";display:block;clear:both}.messageLeft[_ngcontent-%COMP%]{float:left}.messageRight[_ngcontent-%COMP%]{float:right}']],data:{}});function View_MessagePage_1(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,3,\"div\",[],null,null,null,null,null)),(_l()(),core.qb(1,0,null,null,2,\"div\",[],[[8,\"className\",0]],null,null,null,null)),(_l()(),core.qb(2,0,null,null,1,\"div\",[[\"class\",\"messageContent\"]],null,null,null,null,null)),(_l()(),core.Gb(3,null,[\"\",\"\"]))],null,(function(_ck,_v){_ck(_v,1,0,\"sent\"==_v.context.$implicit.metadata.type?\"innerMessage messageRight\":\"innerMessage messageLeft\"),_ck(_v,3,0,_v.context.$implicit.content)}))}function View_MessagePage_2(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,7,\"div\",[[\"class\",\"elem\"]],null,null,null,null,null)),(_l()(),core.qb(1,0,null,null,6,\"ion-input\",[[\"type\",\"text\"]],[[2,\"ng-untouched\",null],[2,\"ng-touched\",null],[2,\"ng-pristine\",null],[2,\"ng-dirty\",null],[2,\"ng-valid\",null],[2,\"ng-invalid\",null],[2,\"ng-pending\",null]],[[null,\"ngModelChange\"],[null,\"ionBlur\"],[null,\"ionChange\"]],(function(_v,en,$event){var ad=!0,_co=_v.component;return\"ionBlur\"===en&&(ad=!1!==core.Cb(_v,2)._handleBlurEvent($event.target)&&ad),\"ionChange\"===en&&(ad=!1!==core.Cb(_v,2)._handleInputEvent($event.target)&&ad),\"ngModelChange\"===en&&(ad=!1!==(_co.reply.content=$event)&&ad),ad}),ionic_angular_ngfactory.S,ionic_angular_ngfactory.n)),core.pb(2,4341760,null,0,ionic_angular.Gb,[core.p,core.k],null,null),core.Db(1024,null,fesm2015_forms.e,(function(p0_0){return[p0_0]}),[ionic_angular.Gb]),core.pb(4,671744,null,0,fesm2015_forms.j,[[8,null],[8,null],[8,null],[6,fesm2015_forms.e]],{model:[0,\"model\"]},{update:\"ngModelChange\"}),core.Db(2048,null,fesm2015_forms.f,null,[fesm2015_forms.j]),core.pb(6,16384,null,0,fesm2015_forms.g,[[4,fesm2015_forms.f]],null,null),core.pb(7,49152,null,0,ionic_angular.D,[core.h,core.k,core.x],{type:[0,\"type\"]},null)],(function(_ck,_v){_ck(_v,4,0,_v.component.reply.content),_ck(_v,7,0,\"text\")}),(function(_ck,_v){_ck(_v,1,0,core.Cb(_v,6).ngClassUntouched,core.Cb(_v,6).ngClassTouched,core.Cb(_v,6).ngClassPristine,core.Cb(_v,6).ngClassDirty,core.Cb(_v,6).ngClassValid,core.Cb(_v,6).ngClassInvalid,core.Cb(_v,6).ngClassPending)}))}function View_MessagePage_0(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,7,\"ion-header\",[],null,null,null,ionic_angular_ngfactory.Q,ionic_angular_ngfactory.l)),core.pb(1,49152,null,0,ionic_angular.y,[core.h,core.k,core.x],null,null),(_l()(),core.qb(2,0,null,0,5,\"ion-toolbar\",[],null,null,null,ionic_angular_ngfactory.jb,ionic_angular_ngfactory.E)),core.pb(3,49152,null,0,ionic_angular.wb,[core.h,core.k,core.x],null,null),(_l()(),core.qb(4,0,null,0,3,\"ion-title\",[],null,null,null,ionic_angular_ngfactory.ib,ionic_angular_ngfactory.D)),core.pb(5,49152,null,0,ionic_angular.ub,[core.h,core.k,core.x],null,null),(_l()(),core.qb(6,0,null,0,1,\"h1\",[],null,null,null,null,null)),(_l()(),core.Gb(-1,null,[\"Chat\"])),(_l()(),core.qb(8,0,null,null,5,\"ion-content\",[[\"padding\",\"\"]],null,null,null,ionic_angular_ngfactory.N,ionic_angular_ngfactory.i)),core.pb(9,49152,null,0,ionic_angular.r,[core.h,core.k,core.x],null,null),(_l()(),core.qb(10,0,null,0,2,\"div\",[[\"id\",\"chatMessages\"]],null,null,null,null,null)),(_l()(),core.fb(16777216,null,null,1,null,View_MessagePage_1)),core.pb(12,278528,null,0,common.h,[core.N,core.J,core.q],{ngForOf:[0,\"ngForOf\"]},null),(_l()(),core.Gb(-1,0,[\"s \"])),(_l()(),core.qb(14,0,null,null,10,\"ion-footer\",[],null,null,null,ionic_angular_ngfactory.O,ionic_angular_ngfactory.j)),core.pb(15,49152,null,0,ionic_angular.w,[core.h,core.k,core.x],null,null),(_l()(),core.qb(16,0,null,0,8,\"ion-toolbar\",[],null,null,null,ionic_angular_ngfactory.jb,ionic_angular_ngfactory.E)),core.pb(17,49152,null,0,ionic_angular.wb,[core.h,core.k,core.x],null,null),(_l()(),core.qb(18,0,null,0,6,\"div\",[[\"id\",\"footer\"]],null,null,null,null,null)),(_l()(),core.fb(16777216,null,null,1,null,View_MessagePage_2)),core.pb(20,16384,null,0,common.i,[core.N,core.J],{ngIf:[0,\"ngIf\"]},null),(_l()(),core.qb(21,0,null,null,3,\"div\",[[\"class\",\"elem\"]],null,null,null,null,null)),(_l()(),core.qb(22,0,null,null,2,\"button\",[[\"icon-only\",\"\"],[\"ion-button\",\"\"]],null,[[null,\"click\"]],(function(_v,en,$event){var ad=!0;return\"click\"===en&&(ad=!1!==_v.component.sendMessage()&&ad),ad}),null,null)),(_l()(),core.qb(23,0,null,null,1,\"ion-icon\",[[\"name\",\"send\"]],null,null,null,ionic_angular_ngfactory.R,ionic_angular_ngfactory.m)),core.pb(24,49152,null,0,ionic_angular.z,[core.h,core.k,core.x],{name:[0,\"name\"]},null)],(function(_ck,_v){var _co=_v.component;_ck(_v,12,0,_co.messages),_ck(_v,20,0,_co.reply),_ck(_v,24,0,\"send\")}),null)}function View_MessagePage_Host_0(_l){return core.Hb(0,[(_l()(),core.qb(0,0,null,null,1,\"app-message\",[],null,null,null,View_MessagePage_0,RenderType_MessagePage)),core.pb(1,114688,null,0,MessagePage,[angular_fire_auth.a,angular_fire_storage.a,storage_service.a,angular_fire_firestore.a],null,null)],(function(_ck,_v){_ck(_v,1,0)}),null)}var MessagePageNgFactory=core.mb(\"app-message\",MessagePage,View_MessagePage_Host_0,{},{},[]),router=__webpack_require__(\"iInd\");class MessagePageRoutingModule{}__webpack_require__.d(__webpack_exports__,\"MessagePageModuleNgFactory\",(function(){return MessagePageModuleNgFactory}));var MessagePageModuleNgFactory=core.nb(MessagePageModule,[],(function(_l){return core.zb([core.Ab(512,core.j,core.Y,[[8,[router_ngfactory.a,MessagePageNgFactory]],[3,core.j],core.v]),core.Ab(4608,common.k,common.j,[core.s,[2,common.q]]),core.Ab(4608,fesm2015_forms.l,fesm2015_forms.l,[]),core.Ab(4608,ionic_angular.a,ionic_angular.a,[core.x,core.g]),core.Ab(4608,ionic_angular.Ab,ionic_angular.Ab,[ionic_angular.a,core.j,core.p]),core.Ab(4608,ionic_angular.Db,ionic_angular.Db,[ionic_angular.a,core.j,core.p]),core.Ab(1073742336,common.b,common.b,[]),core.Ab(1073742336,fesm2015_forms.k,fesm2015_forms.k,[]),core.Ab(1073742336,fesm2015_forms.b,fesm2015_forms.b,[]),core.Ab(1073742336,ionic_angular.yb,ionic_angular.yb,[]),core.Ab(1073742336,router.o,router.o,[[2,router.t],[2,router.m]]),core.Ab(1073742336,MessagePageRoutingModule,MessagePageRoutingModule,[]),core.Ab(1073742336,MessagePageModule,MessagePageModule,[]),core.Ab(1024,router.k,(function(){return[[{path:\"\",component:MessagePage}]]}),[])])}))}}]);","extractedComments":[]}