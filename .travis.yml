dist: trusty

language: node_js
node_js:
  - "12"

addons:
  chrome: stable
  
before_install:
  - cd frontend

before_script:
  - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9876 http://localhost &

script:
  - npm run test -- --no-watch --code-coverage --reporters=coverage,coveralls --no-progress --browsers=ChromeHeadlessCI

after_script:
  - cat ../coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js

after_failure:

addons:
  artifacts:
    paths:
       - $(git ls-files -o | tr "\n" ":")

deploy:

- provider: s3
- access_key_id: $ARTIFACTS_KEY
- secret_access_key: $ARTIFACTS_SECRET
- bucket: $ARTIFACTS_BUCKET
- skip_cleanup: true
- acl: public_read
